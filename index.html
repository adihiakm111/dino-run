<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dino Run ðŸ¦–</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(to top, #c8e6c9 40%, #bbdefb 60%);
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      transition: background 1s;
    }

    body.night {
      background: linear-gradient(to top, #0d1b2a 40%, #1b263b 60%);
    }

    canvas {
      display: none;
      background: linear-gradient(to top, #a5d6a7 40%, #b3e5fc 60%);
      border: 4px solid #222;
      border-radius: 12px;
      transition: background 1s;
    }

    canvas.night {
      background: linear-gradient(to top, #222831 40%, #393e46 60%);
    }

    #menu, #restartMenu { text-align: center; }

    button {
      padding: 12px 28px;
      font-size: 1.3em;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 20px;
    }

    #restartMenu { display: none; }

    #top3 {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 14px;
      background: rgba(255,255,255,0.7);
      border-radius: 10px;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="top3">Top 3 Scores: -</div>

<div id="menu">
  <h1>Dino Run ðŸ¦–</h1>
  <button id="startBtn">Start Game</button>
</div>

<canvas id="gameCanvas"></canvas>

<div id="restartMenu">
  <h2>Game Over</h2>
  <p id="finalScore"></p>
  <button id="restartBtn">Restart</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function setupCanvas() {
  if (window.innerWidth < 600) {
    canvas.width = window.innerWidth * 0.95;
    canvas.height = window.innerHeight * 0.55;
  } else {
    canvas.width = window.innerWidth * 0.75;
    canvas.height = window.innerHeight * 0.70;
  }
}
setupCanvas();

let dino, cactus, ground, score, gameOver;

const menu = document.getElementById("menu");
const restartMenu = document.getElementById("restartMenu");
const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");
const finalScore = document.getElementById("finalScore");
const top3Div = document.getElementById("top3");

let topScores = JSON.parse(localStorage.getItem("topScores") || "[]");

function updateTopScores(s) {
  topScores.push(s);
  topScores.sort((a, b) => b - a);
  topScores = topScores.slice(0, 3);
  localStorage.setItem("topScores", JSON.stringify(topScores));
  top3Div.textContent = "Top 3 Scores: " + topScores.join(", ");
}
updateTopScores(0);

function initGame() {
  document.body.classList.remove("night");

  dino = {
    x: 50,
    y: 0,
    w: 50,
    h: 50,
    vy: 0,
    gravity: 1.3,
    jumpPower: -20,
    grounded: false
  };

  ground = { y: canvas.height - 100, h: 100 };

  cactus = {
    x: canvas.width + 120,
    y: ground.y - 45,
    w: 45,
    h: 45,
    speed: 7
  };

  score = 0;
  gameOver = false;

  menu.style.display = "none";
  restartMenu.style.display = "none";
  canvas.style.display = "block";
}

function jump() {
  if (dino.grounded) {
    dino.vy = dino.jumpPower;
    dino.grounded = false;
  }
}

// FULL-SCREEN JUMP
document.addEventListener("mousedown", jump);
document.addEventListener("touchstart", jump);
document.addEventListener("keydown", e => { if (e.code === "Space") jump(); });

function update() {
  if (gameOver) return;

  // AUTO SPEED FORMULA
  let level = Math.floor(score / 5); 
  let extra = (level % 2 === 0) ? 2 : 3;
  cactus.speed = 5 + (level * extra);

  if (score >= 50) {
    document.body.classList.add("night");
    canvas.classList.add("night");
  }

  dino.vy += dino.gravity;
  dino.y += dino.vy;

  if (dino.y + dino.h >= ground.y) {
    dino.y = ground.y - dino.h;
    dino.vy = 0;
    dino.grounded = true;
  }

  cactus.x -= cactus.speed;
  if (cactus.x + cactus.w < 0) {
    cactus.x = canvas.width + 200;
    score++;
  }

  const dinoBox = {l: dino.x, r: dino.x + dino.w, t: dino.y, b: dino.y + dino.h};
  const cactusBox = {l: cactus.x, r: cactus.x + cactus.w, t: cactus.y, b: cactus.y + cactus.h};

  if (dinoBox.l < cactusBox.r && dinoBox.r > cactusBox.l && dinoBox.t < cactusBox.b && dinoBox.b > cactusBox.t) {
    gameOver = true;
    updateTopScores(score);
    setTimeout(showRestart, 400);
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#6d4c41";
  ctx.fillRect(0, ground.y, canvas.width, ground.h);

  ctx.font = "48px Arial";
  ctx.fillText("ðŸŒµ", cactus.x, cactus.y + cactus.h);

  ctx.fillText("ðŸ¦–", dino.x, dino.y + dino.h);

  ctx.fillStyle = "#111";
  ctx.font = "24px Arial";
  ctx.fillText("Score: " + score, 20, 35);
}

function loop() {
  update();
  draw();
  if (!gameOver) requestAnimationFrame(loop);
}

function showRestart() {
  canvas.style.display = "none";
  restartMenu.style.display = "block";
  finalScore.textContent = "Your Score: " + score;
}

startBtn.onclick = () => { initGame(); loop(); };
restartBtn.onclick = () => { initGame(); loop(); };
</script>

</body>
</html>
